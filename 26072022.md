### ê°œì¸ê³¼ì œë¥¼ ì‹œìž‘í•´ì•¼í•˜ëŠ” ë‚ ! ðŸ¤ª 
ì•„ì§ë„ ëª¨ë¥´ëŠ”ê²Œ ë„ˆë¬´ ë§Žë‹¤.. ì‚¬ì‹¤ ë­˜ ëª¨ë¥´ëŠ”ì§€ë„ ëª¨ë¥´ëŠ” ìƒíƒœìž„

#### mongoose ì˜ ëª¨ë¸ê³¼ ìŠ¤í‚¤ë§ˆ

* ìŠ¤í‚¤ë§ˆ : í•´ë‹¹ ì»¬ë ‰ì…˜ì˜ ë¬¸ì„œì— ì–´ë–¤ ì¢…ë¥˜ì˜ ê°’ì´ ë“¤ì–´ê°€ëŠ”ì§€ì— ëŒ€í•œ ì •ì˜
  
  ```javascript
  const mongoose = require('mongoose'); //mongoose ê°€ì ¸ì˜¤ê¸°
  const Schema = mongoose.Schema; //const { Schema } = mongoose; ë¡œë„ ê°€ëŠ¥

  const Author = new Schema({
    name: String,
    email: String
  });
  
  const Book = new Schema({
    title: String,
    authors: [Author], // ìœ„ì—ì„œ ë§Œë“  Author ìŠ¤í‚¤ë§ˆë¥¼ ê°€ì§„ ê°ì²´ë“¤ì˜ ë°°ì—´í˜•íƒœë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
    publishedDate: Date,
    price: Number,
    tags: [String],
    createdAt: { // ê¸°ë³¸ê°’ì„ ì„¤ì •í• ë• ì´ë ‡ê²Œ ê°ì²´ë¡œ ì„¤ì •í•´ì¤ë‹ˆë‹¤
        type: Date,
        default: Date.now // ê¸°ë³¸ê°’ì€ í˜„ìž¬ ë‚ ì§œë¡œ ì§€ì •í•©ë‹ˆë‹¤.
    }
  });
  
  module.exports = mongoose.model('Book', Book); 
  //ìŠ¤í‚¤ë§ˆë¥¼ ëª¨ë¸ë¡œ ë³€í™˜í•˜ê³  ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš© í•  ìˆ˜ ìžˆë„ë¡ ë‚´ë³´ë‚´ê¸° 
  ```
  
  - ì›¹ ì„œë²„ì˜ ë°ì´í„°ì™€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ê°€ ë‹¬ë¼ë„, ì—ëŸ¬ëŠ” ë‚˜ì§€ ì•Šì§€ë§Œ Undefined ë¡œ ì¶œë ¥
 
* ëª¨ë¸
  - ìŠ¤í‚¤ë§ˆë¥¼ í†µí•´ì„œ ë§Œë“œëŠ” ì¸ìŠ¤í„´ìŠ¤ë¡œ ë‘ ê°œì˜ íŒŒë¼ë¯¸í„°ê°€ í•„ìš”
  - ì²«ë²ˆì§¸ëŠ” íŒŒë¼ë¯¸í„°ëŠ” í•´ë‹¹ ìŠ¤í‚¤ë§ˆì˜ ì´ë¦„ì´ê³ , ë‘ë²ˆì§¸ëŠ” ìŠ¤í‚¤ë§ˆ ê°ì²´
  - ìŠ¤í‚¤ë§ˆì˜ ì´ë¦„ì„ ì •í•´ì£¼ë©´, ì´ì˜ ë³µìˆ˜í˜•íƒœë¡œ ì»¬ë ‰ì…˜ì´ë¦„ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
  
  ```javascript
  const Blog = mongoose.model('Blog', blogSchema);
  ```
  
## ìž¥ë°”êµ¬ë‹ˆ êµ¬í˜„ 

* í•„ìš”í•œ ê¸°ëŠ¥ => ëª©ë¡ ì¡°íšŒ / ìƒí’ˆ ì¶”ê°€ / ìƒí’ˆ ì œê±° / ìƒí’ˆìˆ˜ëŸ‰ ìˆ˜ì •
* ìž¥ë°”êµ¬ë‹ˆ ëª¨ë¸ ìž‘ì„± 
  - ì–´ë–¤ ë°ì´í„° í•„ìš”? ì–´ë–¤ ìƒí’ˆì„, ëª‡ ê°œ ë‹´ì•˜ëŠ”ì§€ ì•Œì•„ì•¼ í•¨

1) ìž¥ë°”êµ¬ë‹ˆ ëª©ë¡ ì¡°íšŒ API ìž‘ì„±

* ìž¥ë°”êµ¬ë‹ˆ ë°ì´í„° ì°¾ì•„ì˜¤ê¸°
* ìž¥ë°”êµ¬ë‹ˆ DBì—ëŠ” goodsIdì™€ quantity ì •ë³´ ë°–ì— ë‹´ê²¨ì ¸ ìžˆì§€ ì•Šê¸° ë•Œë¬¸ì— ìž¥ë°”êµ¬ë‹ˆ ìƒí’ˆ idì— ë§žëŠ” ìƒí’ˆ ì •ë³´ë¥¼ í•œ ë²ˆ ë” ê°€ì ¸ì˜´ (json í˜•ì‹ìœ¼ë¡œ)
  
* /routes/carts.js
  ```javascript
  
  const express = require("express"); //express ë¶ˆëŸ¬ì˜¤ê¸°
  const Cart = require("../schemas/cart");
  const router = express.Router(); 
  //express ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¤ê³  ìƒˆë¡œìš´ Router ë¥¼ ë§Œë“¤ì—ˆë‹¤. ì´ Router ì˜ ì´ë¦„ì€ router!

  router.get("/carts", async (req, res) => {
    const carts = await Cart.find();
    const goodsIds = carts.map((cart) => cart.goodsId);

    const goods = await Goods.find({ goodsId: goodsIds });

    const results = carts.map((cart) => {
      return {
        quantity: cart.quantity,
        goods: goods.find((item) => item.goodsId === cart.goodsId)
      };
    });

    res.json({
      carts: results,
    });
  });

  module.exports = router;
  ```

* /app.js
  ```javascript
  const cartsRouter = require("./routes/carts");
  app.use("/api", [goodsRouter, cartsRouter]);
  ```

2) ìž¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì¶”ê°€ API ìž‘ì„±

* í•„ìš”í•œ ê°’ : goodsId, quantity
* êµ¬í˜„ ë°©ë²• : POST method + /goods/:goodsId/cart ì— ëŒ€ì‘í•˜ëŠ” API
* /routes/goods.js 

  ```javascript
  router.post("/goods/:goodsId/cart", async (req, res) => {
    cost { goodsId } = req.params;
    const { quantity } = req.body;
    
    const existCarts = await Cart.find({ goodsId:Number(goodsId) });
    if (existCarts.length) {
      return res.json({ success: false, errorMessage:"ì´ë¯¸ ìž¥ë°”êµ¬ë‹ˆì— ì¡´ìž¬í•˜ëŠ” ìƒí’ˆìž…ë‹ˆë‹¤." });}
      
      await Cart.create({ goodsId:Number(goodsId), quantity: quantity });

  ```

3) ìž¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ì œê±° API ìž‘ì„±

* ìƒí’ˆ ì¶”ê°€ APIì™€ ë™ì¼í•œ URI ì‚¬ìš©
* goodsIdë¥¼ í†µí•´ ìž¥ë°”êµ¬ë‹ˆ ë‚´ ìƒí’ˆ ì •ë³´ ì‚­ì œ
* DELETE method ì‚¬ìš©

* /routes/goods.js 

  ```javascript
  router.delete(":/goods/:goodsId/cart", async (req,res) => {
    const { goodsId } = req.params;
    
    const existsCarts = await Cart.find ({ goodsId });
    if (existsCarts.length > 0 {
      await Cart.deleteOne({ goodsId });
      }
      
      res.json({result : "success});
      });
  
  
4) ìž¥ë°”êµ¬ë‹ˆ ìƒí’ˆ ìˆ˜ëŸ‰ ìˆ˜ì • API ìž‘ì„±

* ìƒí’ˆ ì¶”ê°€ APIì™€ ë¹„ìŠ·
* í•˜ì§€ë§Œ POST ê°€ ì•„ë‹ˆë¼ PUT methodë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„° update
* goodsIdë¥¼ ì´ìš©í•´ì„œ ìƒí’ˆì •ë³´ê°€ ìž¥ë°”êµ¬ë‹ˆë‚´ì— ì¡´ìž¬í•œë‹¤ë©´ bodyë¥¼ í†µí•´ ë°›ì•„ì˜¨ quantity ê°’ì— ë§žê²Œ ìƒí’ˆ ìˆ˜ëŸ‰ì„ ìˆ˜ì •
 
* /routes/goods.js 

  ```javascript
  
  router.put("/goods/:goodsId/cart", async (req,res) => {
    const { goodsId } = req.params;
    const { quantity } = req.body;
    
    const existsCarts = await Cart.find ({ goodsId: Number(goodsId) });
    if (existsCarts.length) {
      await Cart.updateOne({ goodsId: Number(goodsId)}, { $set: { quantkty } });
      }
      res.json({success : ture});
      })
  ```
  
  
